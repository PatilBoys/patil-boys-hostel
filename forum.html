<!DOCTYPE html>
<html lang="en">
<head>
    <script src="https://cdn.jsdelivr.net/npm/jsrsasign"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NEET Students Discussion Forum</title>
    <style>
        /* General Styles */
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f9f9f9;
        }

        header {
            background-color: #6a1b9a;
            color: white;
            text-align: center;
            padding: 1.5rem 0;
        }

        header h1 {
            margin: 0;
            font-size: 2rem;
        }

        header h1 span {
            font-size: 0.8rem;
        }

        #visitor-counter {
            position: fixed;
            top: 10px;
            right: 10px;
            background: linear-gradient(135deg, #8e24aa, #6a1b9a);
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 1rem;
            font-weight: bold;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            animation: pulse 1.5s infinite;
            z-index: 1000;
        }

        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
                box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            }
            50% {
                transform: scale(1.1);
                box-shadow: 0 6px 12px rgba(0, 0, 0, 0.4);
            }
        }

        .forum-container {
            max-width: 900px;
            margin: 2rem auto;
            padding: 1.5rem;
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }

        textarea, select {
            width: 100%;
            padding: 10px;
            margin-bottom: 1rem;
            border: 1px solid #ddd;
            border-radius: 8px;
            resize: none;
        }

        textarea:focus, select:focus {
            outline: none;
            border-color: #6a1b9a;
        }

        button {
            background-color: #6a1b9a;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        button:hover {
            background-color: #8e24aa;
        }

        .topic {
            margin-bottom: 1.5rem;
            padding: 1rem;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f5f5f5;
        }

        .footer-links {
            text-align: center;
            margin-top: 2rem;
        }

        .footer-links a {
            background: #6a1b9a;
            color: white;
            text-decoration: none;
            padding: 10px 20px;
            border-radius: 8px;
            margin: 0 10px;
            display: inline-block;
        }
    </style>
</head>
<body>
    <!-- Header Section -->
    <header>
        <h1>NEET Students Discussion Forum <span>(powered by Patil Boys Hostel)</span></h1>
    </header>

    <!-- Visitor Counter -->
    <div id="visitor-counter">
        Visitors: <span id="visitor-count">0</span>
    </div>

    <!-- Forum Container -->
    <div class="forum-container">
        <!-- Admin Login -->
        <div class="admin-login">
            <button id="show-admin-login-btn">Admin Login</button>
            <div id="admin-login-form" style="display: none;">
                <input type="email" id="admin-email" placeholder="Enter admin email">
                <input type="password" id="admin-password" placeholder="Enter admin password">
                <button id="admin-login-btn">Login</button>
            </div>
        </div>

        <!-- Post New Topic -->
        <div class="new-topic">
            <h2>Post a New Topic</h2>
            <select id="topic-category">
                <option value="General">General</option>
                <option value="Physics">Physics</option>
                <option value="Chemistry">Chemistry</option>
                <option value="Biology">Biology</option>
                <option value="Mathematics">Mathematics</option>
            </select>
            <textarea id="topic-content" placeholder="Write your topic here..."></textarea>
            <button id="post-topic-btn">Post Topic</button>
        </div>

        <!-- Topics Section -->
        <div id="topics">
            <h2>Topics</h2>
        </div>

        <!-- Footer Links -->
        <div class="footer-links">
            <a href="index.html">Back to Home</a>
            <a href="countdown.html">NEET Countdown</a>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.5.0/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/11.5.0/firebase-auth.js";
        import { getFirestore, collection, addDoc, doc, getDoc, updateDoc, onSnapshot, setDoc } from "https://www.gstatic.com/firebasejs/11.5.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDW61lbc8uDu9nKwi9Lo5nmvZr9osr5MBY",
            authDomain: "patil-boys-forum.firebaseapp.com",
            projectId: "patil-boys-forum",
            storageBucket: "patil-boys-forum.appspot.com",
            messagingSenderId: "884346512770",
            appId: "1:884346512770:web:863a2847c49dfc4e635b9b",
            measurementId: "G-F6LE1SS08C"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        let isAdmin = false;

        const visitorCountElement = document.getElementById('visitor-count');
        const showAdminLoginButton = document.getElementById('show-admin-login-btn');
        const adminLoginForm = document.getElementById('admin-login-form');
        const adminEmailInput = document.getElementById('admin-email');
        const adminPasswordInput = document.getElementById('admin-password');
        const adminLoginButton = document.getElementById('admin-login-btn');
        const topicCategorySelect = document.getElementById('topic-category');
        const topicContentInput = document.getElementById('topic-content');
        const postTopicButton = document.getElementById('post-topic-btn');
        const topicsContainer = document.getElementById('topics');

        showAdminLoginButton.addEventListener('click', () => {
            adminLoginForm.style.display = 'block';
            showAdminLoginButton.style.display = 'none';
        });

        adminLoginButton.addEventListener('click', async () => {
            const email = adminEmailInput.value.trim();
            const password = adminPasswordInput.value.trim();

            try {
                await signInWithEmailAndPassword(auth, email, password);
                isAdmin = true;
                alert("Admin privileges granted!");
                fetchTopics();
            } catch (error) {
                console.error("Login failed:", error);
                alert("Invalid credentials. Please try again.");
            }
        });

        async function fetchTopics() {
            const topicsCollection = collection(db, "topics");
            onSnapshot(topicsCollection, (snapshot) => {
                topicsContainer.innerHTML = "";
                snapshot.forEach((doc) => {
                    const data = doc.data();
                    const topicElement = document.createElement("div");
                    topicElement.classList.add("topic");
                    topicElement.innerHTML = `
                        <h3>${data.category} - ${data.content}</h3>
                        <textarea placeholder="Write a reply..."></textarea>
                        <button onclick="postReply('${doc.id}', this.previousElementSibling.value)">Post Reply</button>
                        <div class="reply">
                            ${data.replies?.map((reply, index) => `
                                <p>Answer ${index + 1}: ${reply} ${isAdmin ? `<button onclick="deleteReply('${doc.id}', ${index})">Delete</button>` : ""}</p>
                            `).join("") || ""}
                        </div>
                        ${isAdmin ? `<button onclick="deleteTopic('${doc.id}')">Delete Topic</button>` : ""}
                    `;
                    topicsContainer.appendChild(topicElement);
                });
            });
        }

        async function updateVisitorCount() {
            const visitorDocRef = doc(db, "statistics", "visitorCount");

            try {
                const visitorDoc = await getDoc(visitorDocRef);
                if (visitorDoc.exists()) {
                    const currentCount = visitorDoc.data().count || 0;
                    await updateDoc(visitorDocRef, { count: currentCount + 1 });
                    visitorCountElement.textContent = currentCount + 1;
                } else {
                    await setDoc(visitorDocRef, { count: 1 });
                    visitorCountElement.textContent = 1;
                }
            } catch (error) {
                console.error("Error updating visitor count:", error);
            }
        }

        updateVisitorCount();
        fetchTopics();
    </script>
</body>
</html>
